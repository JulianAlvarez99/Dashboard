{# ── Table Widget partial (downtime_table & product_ranking) ──
     Expects: wid from parent loop
     Data shape: { columns: [{key, label}], rows: [{...}], total_production? }
#}
<div x-show="widgetResults['{{ wid }}'] && widgetResults['{{ wid }}'].data && !(widgetResults['{{ wid }}'].metadata && widgetResults['{{ wid }}'].metadata.empty){% if w.downtime_only %} && !isMultiLine{% endif %}"
     x-cloak class="widget-card-body">
  <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3"
      x-text="widgetResults['{{ wid }}']?.widget_name"></h3>

  {# Total production summary for product_ranking #}
  <p x-show="widgetResults['{{ wid }}']?.data?.total_production"
     class="mb-2 text-sm text-gray-500">
    Producción total:
    <span class="font-semibold text-white"
          x-text="widgetResults['{{ wid }}']?.data?.total_production?.toLocaleString('es-AR')"></span>
  </p>

  <div class="overflow-x-auto overflow-y-auto" style="max-height: 400px">
    <table class="w-full text-sm text-left text-gray-400">
      <thead class="text-[10px] uppercase text-gray-500 bg-surface-800 sticky top-0 z-10">
        <tr>
          <template x-for="col in (widgetResults['{{ wid }}']?.data?.columns || [])" :key="col.key">
            <th class="px-4 py-2.5" x-text="col.label"></th>
          </template>
        </tr>
      </thead>
      <tbody>
        <template x-for="(row, idx) in (widgetResults['{{ wid }}']?.data?.rows || [])" :key="idx">
          <tr class="border-b border-surface-700/40 hover:bg-surface-800/50 transition-colors">
            <template x-for="col in (widgetResults['{{ wid }}']?.data?.columns || [])" :key="col.key">
              <td class="px-4 py-2.5">
                {# Percentage bar #}
                <template x-if="col.key === 'percentage'">
                  <div class="flex items-center gap-2">
                    <div class="w-16 bg-surface-700 rounded-full h-1.5">
                      <div class="bg-accent-500 h-1.5 rounded-full" :style="'width:' + Math.min(row[col.key], 100) + '%'"></div>
                    </div>
                    <span x-text="row[col.key] + '%'"></span>
                  </div>
                </template>
                {# Product name with color dot #}
                <template x-if="col.key === 'product_name'">
                  <span class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full inline-block" :style="'background:' + (row.product_color || '#888')"></span>
                    <span x-text="row[col.key]"></span>
                  </span>
                </template>
                {# Default cell #}
                <template x-if="col.key !== 'percentage' && col.key !== 'product_name'">
                  <span x-text="typeof row[col.key] === 'number' ? row[col.key].toLocaleString('es-AR') : row[col.key]"></span>
                </template>
              </td>
            </template>
          </tr>
        </template>
        {# No data row #}
        <template x-if="!widgetResults['{{ wid }}']?.data?.rows || widgetResults['{{ wid }}'].data.rows.length === 0">
          <tr>
            <td :colspan="(widgetResults['{{ wid }}']?.data?.columns || []).length"
                class="px-4 py-6 text-center text-gray-500">
              No hay datos disponibles
            </td>
          </tr>
        </template>
      </tbody>
    </table>
  </div>
  <p x-show="widgetResults['{{ wid }}']?.metadata?.total_rows > 0"
     class="mt-2 text-[10px] text-gray-500">
    Total: <span x-text="widgetResults['{{ wid }}']?.metadata?.total_rows"></span> registros
  </p>
</div>
